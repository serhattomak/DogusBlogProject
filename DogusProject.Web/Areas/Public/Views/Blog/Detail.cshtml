@model DogusProject.Web.Models.Blog.ViewModels.BlogDetailViewModel

@{
    ViewData["Title"] = Model.Blog?.Title ?? "Blog Detay";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@if (Model?.Blog == null)
{
    <div class="alert alert-danger">Blog bulunamadı.</div>
}
else
{
    <div class="card mb-4">
        <div class="card-body">

            <h2 class="card-title">@Model.Blog.Title</h2>

            <p class="text-muted">
                <small>
                    Kategori: <span class="badge bg-info">
                        <a asp-area="Public"
                           asp-controller="Category"
                           asp-action="BlogsByCategory"
                           asp-route-id="@Model.Blog.Category.Id"
                           class="text-decoration-none fw-semibold text-primary">
                            @Model.Blog.Category.Name
                        </a>
                    </span>
                </small> |
                <small>Yazar: @Model.Blog.Author</small> |
                <small>Oluşturulma: @Model.Blog.CreatedAt.ToString("dd.MM.yyyy HH:mm")</small>
            </p>

            @if (Model.Blog.ImageUrls != null && Model.Blog.ImageUrls.Any())
            {
                <div class="text-center mb-4">
                    <a href="#" data-bs-toggle="modal" data-bs-target="#imageModal">
                        <img src="@Model.Blog.ImageUrls.First()" 
                             alt="Blog Görseli" 
                             class="img-fluid rounded shadow-sm" 
                             style="max-height: 500px; object-fit: contain;" />
                    </a>
                </div>
            }

            @if (Model.Blog.ImageUrls.Count > 0)
            {
                var modalId = "imageModal";
                var carouselId = "modalCarousel";

                <div class="modal fade" id="@modalId" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-body p-0">
                                <div id="@carouselId" class="carousel slide" data-bs-ride="carousel">
                                    <div class="carousel-inner">
                                        @for (int i = 0; i < Model.Blog.ImageUrls.Count; i++)
                                        {
                                            var imageUrl = Model.Blog.ImageUrls[i];
                                            <div class="carousel-item @(i == 0 ? "active" : "")">
                                                <img src="@imageUrl" class="d-block w-100"
                                                     style="max-height: 500px; object-fit: contain;" alt="Görsel @(i + 1)" />
                                            </div>
                                        }
                                    </div>
                                    <button class="carousel-control-prev" type="button" data-bs-target="#@carouselId" data-bs-slide="prev">
                                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                        <span class="visually-hidden">Önceki</span>
                                    </button>
                                    <button class="carousel-control-next" type="button" data-bs-target="#@carouselId" data-bs-slide="next">
                                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                        <span class="visually-hidden">Sonraki</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }


            <div class="mb-3">
                @foreach (var tag in Model.Blog.Tags)
                {
                    <a asp-area="Public"
                       asp-controller="Tag"
                       asp-action="BlogsByTag"
                       asp-route-id="@tag.Id"
                       class="badge bg-light text-dark border me-1">
                        #@tag.Name
                    </a>
                }
            </div>

            <p class="card-text">@Model.Blog.Content</p>

        </div>
    </div>


    <hr />

    <h4>Yorumlar (@Model.Comments.Count)</h4>

    @if (Model.Comments.Any())
    {
        @foreach (var comment in Model.Comments)
        {
            <div class="mb-3 p-3 border rounded shadow-sm">
                <p class="mb-1">@comment.Content</p>
                <small class="text-muted">@comment.CreatedAt.ToString("dd.MM.yyyy HH:mm") - @comment.AuthorFullName</small>
            </div>
        }
    }
    else
    {
        <div class="alert alert-info">Henüz yorum yapılmamış.</div>
    }

    <hr />

    @if (User.Identity!.IsAuthenticated)
    {
        <h5>Yorum Yaz</h5>
        <form asp-action="Detail" asp-route-id="@Model.Blog.Id" method="post">
            @Html.AntiForgeryToken()

            <input type="hidden" name="BlogId" value="@Model.Blog.Id" />

            <div class="mb-3">
                <textarea name="Content" class="form-control" rows="3" placeholder="Yorumunuzu yazın..."></textarea>
            </div>

            <button type="submit" class="btn btn-primary rounded-pill">Yorum Yap</button>
        </form>
    }
    else
    {
        <div class="alert alert-warning">Yorum yapabilmek için <a asp-area="Auth" asp-controller="Auth" asp-action="Login">giriş yapmalısınız</a>.</div>
    }
}


@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}